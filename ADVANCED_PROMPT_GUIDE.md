# ğŸ¤– ê³ ê¸‰ í”„ë¡¬í”„íŠ¸ ì‹œìŠ¤í…œ ê°€ì´ë“œ

## ê°œìš”
"ë°¥ë­‡ë‚˜?!" ì• í”Œë¦¬ì¼€ì´ì…˜ì€ Gemini 2.0 Flashì˜ ê³ ê¸‰ í”„ë¡¬í”„íŠ¸ ì‹œìŠ¤í…œì„ í™œìš©í•˜ì—¬ êµ¬ì¡°í™”ë˜ê³  ì¼ê´€ì„± ìˆëŠ” AI ì‘ë‹µì„ ì œê³µí•©ë‹ˆë‹¤.

## í•µì‹¬ ê¸°ëŠ¥

### 1. CAM ëª¨ë“œ (Cafeteria Avoidance Mode)
êµ¬ë‚´ì‹ë‹¹ì„ í”¼í•˜ê³  ì‹¶ì„ ë•Œ ìë™ìœ¼ë¡œ ì™¸ë¶€ ì‹ë‹¹ì„ ìš°ì„  ì¶”ì²œí•˜ëŠ” ëª¨ë“œì…ë‹ˆë‹¤.

#### ë°œë™ ì¡°ê±´
- `prefer_external: true` ì„¤ì •
- ì‚¬ìš©ìê°€ "êµ¬ë‚´ì‹ë‹¹", "ì‚¬ë‚´ì‹ë‹¹" ë“±ì˜ íšŒí”¼ í‚¤ì›Œë“œ í¬í•¨

#### íŠ¹ì§•
- ì™¸ë¶€ ì‹ë‹¹ ìµœì†Œ 2ê°œ ì´ìƒ ì¶”ì²œ
- ë„ë³´ 15ë¶„ ì´ë‚´ ì œí•œ
- Practicality ê°€ì¤‘ì¹˜ ì¦ê°€

### 2. ìŠ¤ì½”ì–´ë§ ì‹œìŠ¤í…œ

ê° ë©”ë‰´ëŠ” 3ê°€ì§€ ê¸°ì¤€ìœ¼ë¡œ í‰ê°€ë©ë‹ˆë‹¤:

#### ê¸°ë³¸ ëª¨ë“œ ê°€ì¤‘ì¹˜
```
Taste (ë§›)        : 3
Nutrition (ì˜ì–‘)  : 4
Practicality (ì‹¤ìš©ì„±) : 3
```

#### CAM ëª¨ë“œ ê°€ì¤‘ì¹˜
```
Taste (ë§›)        : 3
Nutrition (ì˜ì–‘)  : 3
Practicality (ì‹¤ìš©ì„±) : 4
```

### 3. ê±°ë¦¬ ì •ì±…

**near (ê°€ê¹Œì›€)**: 0~5ë¶„ ë„ë³´ ê±°ë¦¬
**mid (ì¤‘ê°„)**: 6~15ë¶„ ë„ë³´ ê±°ë¦¬
**far (ë¨¼)**: 15ë¶„ ì´ˆê³¼ (ì¶”ì²œí•˜ì§€ ì•ŠìŒ)

### 4. ì¶”ì²œ ì¹´í…Œê³ ë¦¬

#### ìƒìœ„í˜¸í™˜ (Upgrade)
- êµ¬ë‚´ì‹ë‹¹ ë©”ë‰´ì˜ ê³ ê¸‰/í”„ë¦¬ë¯¸ì—„ ë²„ì „
- ê°™ì€ ìš”ë¦¬ì˜ ë” ë§›ìˆëŠ” ë²„ì „
- ì˜ˆ: êµ¬ë‚´ì‹ë‹¹ ê¹€ì¹˜ì°Œê°œ â†’ í”„ë¦¬ë¯¸ì—„ ê¹€ì¹˜ì°Œê°œ ì •ì‹

#### ë¹„ìŠ·í•œ ì¹´í…Œê³ ë¦¬ (Alternative)
- ê°™ì€ ê³„ì—´ì´ì§€ë§Œ ë‹¤ë¥¸ ìŒì‹
- ë¹„ìŠ·í•œ ë§›ì´ë‚˜ ì¡°ë¦¬ë²•
- ì˜ˆ: ê¹€ì¹˜ì°Œê°œ â†’ ìˆœë‘ë¶€ì°Œê°œ

#### ë‚ ì”¨ ê¸°ë°˜ ì˜ˆì™¸ (Wildcard)
- í˜„ì¬ ë‚ ì”¨ì— ìµœì í™”ëœ ë©”ë‰´
- ì™„ì „íˆ ë‹¤ë¥¸ ì¢…ë¥˜ì˜ ìŒì‹
- ì˜ˆ: ë”ìš´ ë‚  â†’ ëƒ‰ë©´, ì¶”ìš´ ë‚  â†’ êµ­ë°¥

## ì‘ë‹µ ë°ì´í„° êµ¬ì¡°

### ì „ì²´ ì‘ë‹µ í˜•íƒœ

```json
{
  "mode": {
    "name": "CAM" | "default",
    "reason": "ëª¨ë“œ ì„ íƒ ì´ìœ "
  },
  "cafeteria_menu": "êµ¬ë‚´ì‹ë‹¹ ë©”ë‰´",
  "recommendations": [
    // ì¶”ì²œ í•­ëª© ë°°ì—´ (3ê°œ)
  ],
  "weather_summary": "ë‚ ì”¨ ìš”ì•½",
  "weather_info": {
    "location": "ì„œìš¸",
    "temperature": 15,
    "condition": "ë§‘ìŒ",
    "precipitation": "ì—†ìŒ"
  }
}
```

### ì¶”ì²œ í•­ëª© êµ¬ì¡°

```json
{
  "type": "ìƒìœ„í˜¸í™˜" | "ë¹„ìŠ·í•œì¹´í…Œê³ ë¦¬" | "ë‚ ì”¨ê¸°ë°˜",
  "menu": "ë©”ë‰´ëª…",
  "category": "ìŒì‹ ì¹´í…Œê³ ë¦¬",
  "reason": "ì¶”ì²œ ì´ìœ  (50ì ì´ë‚´)",
  "price_range": "ê°€ê²©ëŒ€",
  
  "distance": {
    "walking_min": 7,
    "bucket": "near" | "mid",
    "policy_fit": true
  },
  
  "score": {
    "taste": 8,         // 1-10
    "nutrition": 7,     // 1-10
    "practicality": 9,  // 1-10
    "total": 8.0        // ê°€ì¤‘ í‰ê· 
  },
  
  "meta": {
    "source": "nearby" | "inhouse",
    "priceLevel": "â‚©" | "â‚©â‚©" | "â‚©â‚©â‚©",
    "openNow": true
  }
}
```

## ì‹œìŠ¤í…œ ì¸ìŠ¤íŠ¸ëŸ­ì…˜

ë°±ì—”ë“œì˜ `AIService` í´ë˜ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì‹œìŠ¤í…œ ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:

```python
def _get_system_instruction(self) -> str:
    return """
ë‹¹ì‹ ì€ "ë°¥ë­‡ë‚˜?! - ì§ì¥ì¸ ì ì‹¬ ì¶”ì²œ AI"ì…ë‹ˆë‹¤. ì•„ë˜ ê·œì¹™ì— ë”°ë¼ ë©”ë‰´ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.

## í•µì‹¬ ê·œì¹™
1. **ì…ë ¥ ë°ì´í„°**: ì˜¤ëŠ˜ì êµ¬ë‚´ì‹ë‹¹ ë©”ë‰´ëŠ” ì°¸ê³  ìë£Œì…ë‹ˆë‹¤.
2. **CAM ëª¨ë“œ**: ì‚¬ìš©ìê°€ êµ¬ë‚´ì‹ë‹¹ íšŒí”¼ ì˜ì‚¬ë¥¼ ë³´ì´ë©´ ì™¸ë¶€ì‹ë‹¹ ìš°ì„ 
3. **CAM ëª¨ë“œ ì›ì¹™**: ê·¼ì²˜ ì™¸ë¶€ ìŒì‹ì (ë„ë³´ 0~15ë¶„) ì¶”ì²œ ìµœìš°ì„ 
4. **ê±°ë¦¬ ì •ì±…**: ë„ë³´ 0~15ë¶„ ë²”ìœ„ ë‚´ë§Œ ì¶”ì²œ
5. **ìŠ¤ì½”ì–´ë§ ê°€ì¤‘ì¹˜**: ê¸°ë³¸ 3:4:3, CAM 3:3:4
6. **ì˜ˆì™¸(Wildcard)**: CAM ë¬´ê´€ ì™¸ë¶€ ì‹ë‹¹ ìœ„ì£¼
7. **ë‚ ì”¨ ê³ ë ¤**: í˜„ì¬ ë‚ ì”¨ì— ë§ëŠ” ë©”ë‰´ ì¶”ì²œ

## ì¶”ì²œ ì¹´í…Œê³ ë¦¬
1. **ìƒìœ„í˜¸í™˜(upgrade)**: êµ¬ë‚´ì‹ë‹¹ ë©”ë‰´ì˜ ê³ ê¸‰/í”„ë¦¬ë¯¸ì—„ ë²„ì „
2. **ë¹„ìŠ·í•œ ì¹´í…Œê³ ë¦¬(alternative)**: ê°™ì€ ê³„ì—´ì´ì§€ë§Œ ë‹¤ë¥¸ ìŒì‹
3. **ì˜ˆì™¸(wildcard)**: ë‚ ì”¨ ê¸°ë°˜, ì™„ì „íˆ ë‹¤ë¥¸ ì¢…ë¥˜ì˜ ìŒì‹
"""
```

## ë‚ ì”¨ ê¸°ë°˜ ì¶”ì²œ ë¡œì§

### ë”ìš´ ë‚ ì”¨ (25â„ƒ ì´ìƒ)
- ì‹œì›í•œ ë©”ë‰´ ìš°ì„ 
- ëƒ‰ë©´, ìƒëŸ¬ë“œ, ì°¨ê°€ìš´ ë©´ ìš”ë¦¬
- ì„ í˜¸ ë§›: "ì‹œì›í•¨, ê¹”ë”í•¨, ìƒí¼í•¨"

### ì¶”ìš´ ë‚ ì”¨ (10â„ƒ ì´í•˜)
- ë”°ëœ»í•œ êµ­ë¬¼ ìš”ë¦¬
- ì°Œê°œ, êµ­ë°¥, íƒ•ë¥˜
- ì„ í˜¸ ë§›: "ë”°ëœ»í•¨, ë“ ë“ í•¨, ì–¼í°í•¨"

### ë¹„/ëˆˆ ì˜¤ëŠ” ë‚ 
- ì‹¤ë‚´ ìŒì‹, ë”°ëœ»í•œ ë©”ë‰´
- ë¶€ì¹¨ê°œ, ì „ê³¨, ì°œìš”ë¦¬
- ì„ í˜¸ ë§›: "ë”°ëœ»í•¨, ë¶€ë“œëŸ¬ì›€, ìœ„ë¡œ"

## í”„ë¡ íŠ¸ì—”ë“œ í‘œì‹œ

### ì¹´ë“œ ë””ìì¸
- **ìƒìœ„í˜¸í™˜**: ë…¸ë€ìƒ‰~ì£¼í™©ìƒ‰ ê·¸ë¼ë°ì´ì…˜ (â­)
- **ë¹„ìŠ·í•œì¹´í…Œê³ ë¦¬**: ì´ˆë¡ìƒ‰~ì²­ë¡ìƒ‰ ê·¸ë¼ë°ì´ì…˜ (ğŸ½ï¸)
- **ë‚ ì”¨ê¸°ë°˜**: íŒŒë€ìƒ‰~ë³´ë¼ìƒ‰ ê·¸ë¼ë°ì´ì…˜ (ğŸŒ¤ï¸)

### ì •ë³´ í‘œì‹œ
1. **ë°°ì§€**:
   - ì¹´í…Œê³ ë¦¬ (ìŒì‹ ì¢…ë¥˜)
   - ì¶œì²˜ (ğŸƒ ì™¸ë¶€ / ğŸ¢ ì‚¬ë‚´)
   - ê°€ê²©ëŒ€ (â‚©, â‚©â‚©, â‚©â‚©â‚©)

2. **ê±°ë¦¬ ì •ë³´**:
   - ğŸš¶ ë„ë³´ Xë¶„
   - ê±°ë¦¬ í‘œì‹œ (ê°€ê¹Œì›€/ì¤‘ê°„)

3. **ìŠ¤ì½”ì–´ ê·¸ë¦¬ë“œ**:
   - ë§› (ë…¸ë€ìƒ‰)
   - ì˜ì–‘ (ì´ˆë¡ìƒ‰)
   - ì‹¤ìš© (íŒŒë€ìƒ‰)
   - ì´ì  (ë°°ì§€)

## API ì‚¬ìš© ì˜ˆì‹œ

### Python (ë°±ì—”ë“œ)
```python
recommendation = await ai_service.recommend_from_cafeteria_menu(
    weather_data,
    "ê¹€ì¹˜ì°Œê°œ, ëœì¥ì°Œê°œ, ë¹„ë¹”ë°¥",
    user_location={"latitude": 37.5665, "longitude": 126.9780},
    prefer_external=True  # CAM ëª¨ë“œ í™œì„±í™”
)
```

### JavaScript (í”„ë¡ íŠ¸ì—”ë“œ)
```javascript
const result = await cafeteriaAPI.getRecommendation(
  "ì„œìš¸",
  "ê¹€ì¹˜ì°Œê°œ, ëœì¥ì°Œê°œ, ë¹„ë¹”ë°¥",
  { latitude: 37.5665, longitude: 126.9780 },
  true  // CAM ëª¨ë“œ
);
```

## ê°œë°œì ë…¸íŠ¸

### Gemini API ì„¤ì •
- ëª¨ë¸: `gemini-2.0-flash-exp`
- System Instruction ì‚¬ìš©
- JSON ì‘ë‹µ ê°•ì œ (`response_mime_type: "application/json"`)
- Temperature: 0.8 (ì°½ì˜ì  ì¶”ì²œ)

### í´ë°± ë¡œì§
AI API ì‹¤íŒ¨ ì‹œ ê·œì¹™ ê¸°ë°˜ ì¶”ì²œ ì‹œìŠ¤í…œìœ¼ë¡œ ìë™ ì „í™˜:
```python
def _get_fallback_cafeteria_recommendation(self, weather: Dict, cafeteria_menu: str) -> Dict:
    # ë‚ ì”¨ì™€ ë©”ë‰´ ê¸°ë°˜ ê·œì¹™ ì ìš©
    # í•­ìƒ ì•ˆì •ì ì¸ ì‘ë‹µ ë³´ì¥
```

## ì°¸ê³  ë¬¸ì„œ
- [Gemini API ë¬¸ì„œ](https://ai.google.dev/docs)
- [Open-Meteo ë‚ ì”¨ API](https://open-meteo.com/en/docs)
- [DaisyUI ì»´í¬ë„ŒíŠ¸](https://daisyui.com/)

